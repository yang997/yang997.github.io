var dataList,len,control,timer,root=window.player,nowIndex=0,audio=root.audioManager,$scope=$(document.body);function getData(o){$.ajax({type:"GET",url:o,success:function(o){len=(dataList=o).length,control=new root.indexControl(len),root.render(o[0]),audio.getAudio(o[0].audio),root.pro.renderAllTime(dataList[0].duration),bindEvent(),bindTouch(),root.playList.renderList(dataList)},error:function(){}})}function bindEvent(){$scope.on("play:change",function(o,t){audio.getAudio(dataList[t].audio),root.render(dataList[t]),root.pro.renderAllTime(dataList[t].duration),"play"==audio.status?(audio.play(),root.pro.stop(),root.pro.start(0),rotated(0)):root.pro.update(0),$(".img-box").attr("data-deg",0),$(".img-box").css({transform:"ratateZ(0deg)",transtion:"none"})}),$(".prev").on("click",function(){var o=control.prev();$scope.trigger("play:change",o)}),$(".next").on("click",function(){var o=control.next();$scope.trigger("play:change",o)}),$(".play").on("click",function(){"pause"==audio.status?(audio.play(),root.pro.start(),rotated($(".img-box").attr("data-deg"))):(audio.pause(),root.pro.stop(),clearInterval(timer));$(".play").toggleClass("playing")}),$(".list").on("click",function(){root.playList.show(control)})}function bindTouch(){var n=$(".pro-bottom").offset().left,r=$(".pro-bottom").offset().width;$(".slider-point").on("touchstart",function(o){root.pro.stop()}).on("touchmove",function(o){var t=(o.changedTouches[0].clientX-n)/r;0<=t&&t<1&&root.pro.update(t)}).on("touchend",function(o){var t=(o.changedTouches[0].clientX-n)/r,a=t*dataList[control.index].duration;0<=t&&t<1&&(audio.playTo(a),audio.play(),$(".play").addClass("playing"),audio.status="play",root.pro.start(t))})}function rotated(o){clearInterval(timer),o=parseInt(o),timer=setInterval(function(){o+=1,$(".img-box").attr("data-deg",o),$(".img-box").css({transform:"rotateZ("+o+"deg)",transtion:"all 0.1s linear"})},200)}$(audio.audio).on("ended",function(){$(".next").trigger("click")}),getData("../mock/data.json");